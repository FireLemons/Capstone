<!DOCTYPE html>
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
            <title>Mapeople</title>
            <style>
                /* Always set the map height explicitly to define the size of the div
                * element that contains the map. */
                #map {
                    height: 90%;
                }
                /* Optional: Makes the sample page fill the window. */
                html, body {
                    height: 100%;
                    margin: 0;
                    padding: 0;
                }
                #legend {
                    font-family: Arial, sans-serif;
                    background: #fff;
                    padding: 10px;
                    margin: 10px;
                    border: 3px solid #000;
                }
                #legend h3 {
                    margin-top: 0;
                }
                #legend img {
                    vertical-align: middle;
                }
                #floating-panel {
                    position: absolute;
                    top: 10px;
                    left: 25%;
                    z-index: 5;
                    background-color: #fff;
                    padding: 5px;
                    border: 1px solid #999;
                    text-align: center;
                    font-family: 'Roboto','sans-serif';
                    line-height: 30px;
                    padding-left: 10px;
                }
                #floating-panel {
                    background-color: #fff;
                    border: 1px solid #999;
                    left: 25%;
                    padding: 5px;
                    position: absolute;
                    top: 10px;
                    z-index: 5;
                }
            </style>
            <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
			<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.6.0/firebaseui.css" />
			
            <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
            <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

            <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
            <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
            <title>Starter Template - Materialize</title>

            <!-- CSS  -->
            <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
            <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
            <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js '></script>
    </head>
    <body>
        <nav class="green lighten-1" role="navigation">
        <div class="nav-wrapper container"><a id="logo-container" href="index.html" class="brand-logo">Mapeople</a>
            <ul class="right hide-on-med-and-down">
            </ul>

            <ul id="nav-mobile" class="side-nav">
                <li><a href="#">Navbar Link</a></li>
            </ul>
            <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>

            <ul id="nav-mobile-list" class="right hide-on-med-and-down">
            <!-- We populate li's automatically -->
            </ul>

            <ul class="side-nav" id="mobile-demo">
            </ul>
        </div>
        </nav>
        
        <div id="map"></div>
        <div id="legend">
            <h4>Pins</h3>
            <h6><a id="basic-pin" onclick="selectPin('basicPin')" class="">Basic</a></h6>
            <h6><a id="text-pin" onclick="selectPin('textPin')" class="">Text</a></h6>
            <h6><a id="meeting-pin" onclick="selectPin('meetingPin')" class="">Meeting</a></h6>
            <h6><a id="landmark-pin" onclick="selectPin('landmarkPin')" class="">Landmark</a></h6>
            <h6><a id="line-pin" onclick="selectPin('linePin')" class="">Line</a></h6>
            <h6><a id="picture-pin" onclick="selectPin('picturePin')" class="">Picture</a></h6>
            <h6><a id="poll-pin" onclick="selectPin('pollPin')" class="">Poll</a></h6>
        </div>
        <script type="text/javascript" src="https://www.gstatic.com/firebasejs/4.9.0/firebase.js"></script>
		<script src="https://cdn.firebase.com/libs/firebaseui/2.6.0/firebaseui.js"></script>
		<script type="text/javascript" src="js/config.js"></script>
		<script type="text/javascript" src="js/login.js"></script>
        <script>
            var map;
            var currentPinSelection = "basicPin";

            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 16,
                    center: {lat: 38.940451750007945, lng: -92.32772827148438}
                });

                var customMapTypeId = 'custom_style';
                var customMapType = new google.maps.StyledMapType([
                {
                    stylers: [
                        {hue: '#81F9FB'},
                        {visibility: 'simplified'},
                        {gamma: 0.3},
                        {weight: 0.20}
                    ]
                    },
                    {
                        elementType: 'labels',
                        stylers: [{visibility: 'on'}]
                    },
                    {
                        featureType: 'water',
                        stylers: [{color: '#346FFF'}]
                    }
                    ], {
                    name: 'Trippy'
                });

                map.mapTypes.set(customMapTypeId, customMapType);
                map.setMapTypeId(customMapTypeId);

                // tap to add pin to fb
                google.maps.event.addListener(map, 'click', function( event ){

                    switch (currentPinSelection)
                    {
                        case "basicPin":
                            firebase.database().ref('Maps/public/map2/pins').push().set({
                                "lat": event.latLng.lat(),
                                "long": event.latLng.lng(),
                                "type":"basicPin"
                            });
                            break;
                        case "textPin":
                            firebase.database().ref('Maps/public/map2/pins').push().set({
                                "lat": event.latLng.lat(),
                                "long": event.latLng.lng(),
                                "text": "PLACE HOLDER",
                                "type":"textPin"
                            });
                            break;
                        case "meetingPin":
                            firebase.database().ref('Maps/public/map2/pins').push().set({
                                "lat": event.latLng.lat(),
                                "long": event.latLng.lng(),
                                "type":"meetingPin"
                            });
                            break;
                        case "landmarkPin":
                            firebase.database().ref('Maps/public/map2/pins').push().set({
                                "lat": event.latLng.lat(),
                                "long": event.latLng.lng(),
                                "type":"landmarkPin"
                            });
                            break;
                        case "linePin":
                            firebase.database().ref('Maps/public/map2/pins').push().set({
                                "lat": event.latLng.lat(),
                                "long": event.latLng.lng(),
                                "type":"linePin"
                            });
                            break;
                        case "picturePin":
                            firebase.database().ref('Maps/public/map2/pins').push().set({
                                "lat": event.latLng.lat(),
                                "long": event.latLng.lng(),
                                "type":"picturePin"
                            });
                            break;
                        case "pollPin":
                            firebase.database().ref('Maps/public/map2/pins').push().set({
                                "lat": event.latLng.lat(),
                                "long": event.latLng.lng(),
                                "type":"pollPin"
                            });
                            break;
                        default:
                            firebase.database().ref('Maps/public/map2/pins').push().set({
                                "lat": event.latLng.lat(),
                                "long": event.latLng.lng(),
                                "type":"basicPin"
                            });
                            break;
                    } //End switch (currentPinSelection)
                    
                });

                // load from firebase
                var commentsRef = firebase.database().ref('Maps/public/map2/pins');
                commentsRef.on('child_added', function(data) {

                    switch (data.val().type)
                    {
                        case "basicPin":
                            var myLatLng = {lat: data.val().lat, lng: data.val().long};
                            var marker = new google.maps.Marker({
                                position: myLatLng,
                                map: map,
                                title: 'Hello World!',
                                icon: 'oPin3.png'
                            });
                            break;
                        case "textPin":
                            var myLatLng = {lat: data.val().lat, lng: data.val().long};
                            var marker = new google.maps.Marker({
                                position: myLatLng,
                                map: map,
                                title: data.val().text,
                                label: {color: '#00aaff', fontWeight: 'bold', fontSize: '14px', text: data.val().text},
                                icon: 'oPin3.png'
                            });
                            break;
                        case "meetingPin":
                            var myLatLng = {lat: data.val().lat, lng: data.val().long};
                            var marker = new google.maps.Marker({
                                position: myLatLng,
                                map: map,
                                title: 'Hello World!',
                                icon: 'oPin3.png'
                            });
                            break;
                        case "landmarkPin":
                            var myLatLng = {lat: data.val().lat, lng: data.val().long};
                            var marker = new google.maps.Marker({
                                position: myLatLng,
                                map: map,
                                title: 'Hello World!',
                                icon: 'oPin3.png'
                            });
                            break;
                        case "linePin":
                            var myLatLng = {lat: data.val().lat, lng: data.val().long};
                            var marker = new google.maps.Marker({
                                position: myLatLng,
                                map: map,
                                title: 'Hello World!',
                                icon: 'oPin3.png'
                            });
                            break;
                        case "picturePin":
                            var myLatLng = {lat: data.val().lat, lng: data.val().long};
                            var marker = new google.maps.Marker({
                                position: myLatLng,
                                map: map,
                                title: 'Hello World!',
                                icon: 'oPin3.png'
                            });
                            break;
                        case "pollPin":
                            var myLatLng = {lat: data.val().lat, lng: data.val().long};
                            var marker = new google.maps.Marker({
                                position: myLatLng,
                                map: map,
                                title: 'Hello World!',
                                icon: 'oPin3.png'
                            });
                            break;
                        default:
                            var myLatLng = {lat: data.val().lat, lng: data.val().long};
                            var marker = new google.maps.Marker({
                                position: myLatLng,
                                map: map,
                                title: 'Hello World!',
                                icon: 'oPin3.png'
                            });
                            break;
                    } //End switch (data.val().type)

                    /*
                    if(data.val().type == "basicPin"){
                        var myLatLng = {lat: data.val().lat, lng: data.val().long};
                        var marker = new google.maps.Marker({
                            position: myLatLng,
                            map: map,
                            title: 'Hello World!',
                            icon: 'oPin3.png'
                        });
                    }
                    */
                });

                var legend = document.getElementById('legend');

                map.controls[google.maps.ControlPosition.LEFT].push(legend);
            }
			
			function selectPin(selectedPin) {
                console.log("selectPin(selectedPin) called")
                console.dir(selectedPin);
                currentPinSelection = selectedPin;
            }
        </script>
            
        <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDveZT0Eamgm2WQB9PKrg36JcDZh1R3J4Q&libraries=visualization&callback=initMap">
        </script>
        <div class="app"></div>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
            app.initialize();
        </script>
    </body>
</html>